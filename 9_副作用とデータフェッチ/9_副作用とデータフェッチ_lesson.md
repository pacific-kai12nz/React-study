# 9. å‰¯ä½œç”¨ã¨ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ

## 9.1 å‰¯ä½œç”¨ï¼ˆSide Effectsï¼‰ã¨ã¯

React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãŠã‘ã‚‹ã€Œå‰¯ä½œç”¨ã€ã¨ã¯ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ä»¥å¤–ã®å‡¦ç†ã®ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªæ“ä½œãŒå‰¯ä½œç”¨ã«å«ã¾ã‚Œã¾ã™ï¼š

- ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ï¼ˆAPIå‘¼ã³å‡ºã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ï¼‰
- DOM ã®ç›´æ¥æ“ä½œ
- ã‚¿ã‚¤ãƒãƒ¼ã®è¨­å®šï¼ˆsetTimeout, setIntervalï¼‰
- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç™»éŒ²ãƒ»è§£é™¤
- localStorage ãªã©ã®ãƒ–ãƒ©ã‚¦ã‚¶ API ã®åˆ©ç”¨
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€£æº

ã“ã‚Œã‚‰ã®æ“ä½œã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†ã¨ã¯åˆ¥ã«æ‰±ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## 9.2 useEffect ãƒ•ãƒƒã‚¯ã®åŸºæœ¬

React ã§ã¯ã€å‰¯ä½œç”¨ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã« `useEffect` ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```tsx
import React, { useEffect, useState } from 'react';

const Timer: React.FC = () => {
  const [count, setCount] = useState(0);

  // useEffect ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹
  useEffect(() => {
    // ã“ã®ä¸­ã«å‰¯ä½œç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
    console.log('ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã—ãŸ');
    
    // ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®šï¼ˆå‰¯ä½œç”¨ã®ä¾‹ï¼‰
    const timer = setTimeout(() => {
      setCount(count + 1);
    }, 1000);
    
    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹æ™‚ã‚„
    // ä¾å­˜é…åˆ—ã®å€¤ãŒå¤‰ã‚ã£ã¦å†å®Ÿè¡Œã•ã‚Œã‚‹å‰ã«å‘¼ã°ã‚Œã‚‹ï¼‰
    return () => {
      clearTimeout(timer); // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
    };
  }, [count]); // ä¾å­˜é…åˆ— - count ãŒå¤‰ã‚ã‚‹ãŸã³ã« useEffect ãŒå†å®Ÿè¡Œã•ã‚Œã‚‹

  return <div>ã‚«ã‚¦ãƒ³ãƒˆ: {count}</div>;
};
```

### useEffect ã®æ§‹æˆè¦ç´ 

useEffect ã¯ä¸»ã«3ã¤ã®è¦ç´ ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š

1. **ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé–¢æ•°**ï¼šå®Ÿè¡Œã—ãŸã„å‰¯ä½œç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’å«ã‚€é–¢æ•°
2. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ï¼šã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆå¾Œç‰‡ä»˜ã‘ï¼‰ã‚’è¡Œã†é–¢æ•°
3. **ä¾å­˜é…åˆ—**ï¼šã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒä¾å­˜ã™ã‚‹å€¤ã®ãƒªã‚¹ãƒˆ

## 9.3 ä¾å­˜é…åˆ—ï¼ˆDependency Arrayï¼‰

useEffect ã®ç¬¬2å¼•æ•°ã¨ã—ã¦æ¸¡ã™é…åˆ—ã‚’ã€Œä¾å­˜é…åˆ—ã€ã¨å‘¼ã³ã¾ã™ã€‚ã“ã®é…åˆ—ã«å«ã¾ã‚Œã‚‹å€¤ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå†å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

### ä¾å­˜é…åˆ—ã®ä½¿ã„æ–¹

```tsx
// ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®åº¦ã«å®Ÿè¡Œï¼ˆä¾å­˜é…åˆ—ãªã—ï¼‰
useEffect(() => {
  console.log('æ¯å›ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã¾ã™');
});

// ãƒã‚¦ãƒ³ãƒˆæ™‚ã®ã¿å®Ÿè¡Œï¼ˆç©ºã®ä¾å­˜é…åˆ—ï¼‰
useEffect(() => {
  console.log('ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸæ™‚ã ã‘å®Ÿè¡Œã•ã‚Œã¾ã™');
}, []);

// ç‰¹å®šã®å€¤ãŒå¤‰ã‚ã£ãŸæ™‚ã«å®Ÿè¡Œ
useEffect(() => {
  console.log(`count ã®å€¤ãŒ ${count} ã«å¤‰ã‚ã‚Šã¾ã—ãŸ`);
}, [count]);

// è¤‡æ•°ã®å€¤ã‚’ç›£è¦–
useEffect(() => {
  console.log('count ã¾ãŸã¯ name ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ');
}, [count, name]);
```

### ä¾å­˜é…åˆ—ã‚’é©åˆ‡ã«è¨­å®šã™ã‚‹é‡è¦æ€§

ä¾å­˜é…åˆ—ã‚’æ­£ã—ãè¨­å®šã™ã‚‹ã“ã¨ã¯ã€ãƒã‚°ã‚’é˜²ãã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«éå¸¸ã«é‡è¦ã§ã™ã€‚ç‰¹ã«ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå†…ã§ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆå¤‰æ•°ã‚„ props ã¯ä¾å­˜é…åˆ—ã«å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

React ã® ESLint ãƒ«ãƒ¼ãƒ«ï¼ˆeslint-plugin-react-hooksï¼‰ã¯ã€ä¾å­˜é…åˆ—ã«å«ã‚ã‚‹ã¹ãå€¤ãŒæŠœã‘ã¦ã„ã‚‹å ´åˆã«è­¦å‘Šã‚’å‡ºã—ã¦ãã‚Œã¾ã™ã€‚

```tsx
// è­¦å‘ŠãŒå‡ºã‚‹ä¾‹ï¼ˆcount ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã«ä¾å­˜é…åˆ—ã«å«ã‚ã¦ã„ãªã„ï¼‰
useEffect(() => {
  console.log(`count ã®å€¤: ${count}`);
}, []); // ESLint: React Hook useEffect has a missing dependency: 'count'
```

## 9.4 ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°

ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé–¢æ•°ã‹ã‚‰é–¢æ•°ã‚’è¿”ã™ã“ã¨ã§ã€ã€Œã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã€ã‚’å®šç¾©ã§ãã¾ã™ã€‚ã“ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã¯ä»¥ä¸‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹æ™‚ï¼ˆDOM ã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹æ™‚ï¼‰
2. ä¾å­˜é…åˆ—ã®å€¤ãŒå¤‰ã‚ã£ã¦ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå†å®Ÿè¡Œã•ã‚Œã‚‹å‰

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã¯ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã§è¨­å®šã—ãŸã‚‚ã®ã‚’ã€Œå¾Œç‰‡ä»˜ã‘ã€ã™ã‚‹ãŸã‚ã«ä½¿ã„ã¾ã™ã€‚ä¾‹ãˆã°ï¼š

- ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¯ãƒªã‚¢ï¼ˆclearTimeout, clearIntervalï¼‰
- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è§£é™¤
- WebSocket æ¥ç¶šã®åˆ‡æ–­
- ãƒ‡ãƒ¼ã‚¿è³¼èª­ï¼ˆsubscriptionï¼‰ã®è§£é™¤

```tsx
useEffect(() => {
  // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
  window.addEventListener('resize', handleResize);
  
  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã§ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
  return () => {
    window.removeEventListener('resize', handleResize);
  };
}, []); // ãƒã‚¦ãƒ³ãƒˆæ™‚ã«è¿½åŠ ã€ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã«å‰Šé™¤
```

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’é©åˆ‡ã«å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚„ãƒã‚°ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

## 9.5 ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°

useEffect ã®æœ€ã‚‚ä¸€èˆ¬çš„ãªä½¿ç”¨ä¾‹ã®ä¸€ã¤ãŒã€APIã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ï¼‰ã§ã™ã€‚

### åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿å–å¾—ã®ä¾‹

```tsx
import React, { useState, useEffect } from 'react';

interface User {
  id: number;
  name: string;
  email: string;
}

const UserList: React.FC = () => {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    // éåŒæœŸé–¢æ•°ã‚’å®šç¾©
    const fetchUsers = async () => {
      try {
        setLoading(true);
        const response = await fetch('https://jsonplaceholder.typicode.com/users');
        
        if (!response.ok) {
          throw new Error('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
        
        const data = await response.json();
        setUsers(data);
        setError(null);
      } catch (err) {
        setError('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + (err instanceof Error ? err.message : String(err)));
        setUsers([]);
      } finally {
        setLoading(false);
      }
    };

    // é–¢æ•°ã‚’å®Ÿè¡Œ
    fetchUsers();
    
    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã¯ç‰¹ã«å¿…è¦ãªã„å ´åˆã‚‚ã‚ã‚‹
    return () => {
      // å¿…è¦ã«å¿œã˜ã¦ã‚¢ãƒœãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãªã©ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    };
  }, []); // ç©ºã®ä¾å­˜é…åˆ— - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸæ™‚ã ã‘å®Ÿè¡Œ

  if (loading) {
    return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;
  }

  if (error) {
    return <div>ã‚¨ãƒ©ãƒ¼: {error}</div>;
  }

  return (
    <div>
      <h1>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆ</h1>
      <ul>
        {users.map(user => (
          <li key={user.id}>
            {user.name} ({user.email})
          </li>
        ))}
      </ul>
    </div>
  );
};

export default UserList;
```

### ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ç®¡ç†**ï¼šãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã‚’è¡¨ç¤º
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**ï¼šå¤±æ•—ã—ãŸå ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
3. **ä¾å­˜é…åˆ—ã®é©åˆ‡ãªè¨­å®š**ï¼šå¿…è¦ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—
4. **ã‚¢ãƒœãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼**ï¼šå¿…è¦ã«å¿œã˜ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«

```tsx
useEffect(() => {
  // AbortController ã‚’ä½¿ã£ã¦ãƒ•ã‚§ãƒƒãƒã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
  const controller = new AbortController();
  
  const fetchData = async () => {
    try {
      setLoading(true);
      const response = await fetch(url, {
        signal: controller.signal // ã‚¢ãƒœãƒ¼ãƒˆã‚·ã‚°ãƒŠãƒ«ã‚’æ¸¡ã™
      });
      // ä»¥ä¸‹ãƒ‡ãƒ¼ã‚¿å‡¦ç†...
    } catch (err) {
      // AbortError ã¯é€šå¸¸ã®ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã‚ãªã„
      if (err instanceof Error && err.name !== 'AbortError') {
        setError(err.message);
      }
    } finally {
      setLoading(false);
    }
  };
  
  fetchData();
  
  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ™‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
  return () => {
    controller.abort();
  };
}, [url]); // url ãŒå¤‰ã‚ã‚‹ãŸã³ã«ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—
```

## 9.6 useEffect ã®ä½¿ç”¨ã‚±ãƒ¼ã‚¹

useEffect ã¯æ§˜ã€…ãªã‚·ãƒŠãƒªã‚ªã§ä½¿ç”¨ã§ãã¾ã™ï¼š

### 1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã®å¤‰æ›´

```tsx
useEffect(() => {
  document.title = `${count} å›ã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ`;
}, [count]);
```

### 2. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç™»éŒ²

```tsx
useEffect(() => {
  const handleKeyDown = (event: KeyboardEvent) => {
    if (event.key === 'Escape') {
      onClose();
    }
  };
  
  window.addEventListener('keydown', handleKeyDown);
  
  return () => {
    window.removeEventListener('keydown', handleKeyDown);
  };
}, [onClose]);
```

### 3. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ¶å¾¡

```tsx
useEffect(() => {
  if (isVisible) {
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹å§‹
    animation.start();
  }
  
  return () => {
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®åœæ­¢
    animation.stop();
  };
}, [isVisible, animation]);
```

### 4. WebSocket æ¥ç¶š

```tsx
useEffect(() => {
  const socket = new WebSocket('wss://example.com/socket');
  
  socket.onmessage = (event) => {
    const data = JSON.parse(event.data);
    setMessages(prev => [...prev, data]);
  };
  
  socket.onclose = () => {
    console.log('WebSocket æ¥ç¶šãŒé–‰ã˜ã‚‰ã‚Œã¾ã—ãŸ');
  };
  
  return () => {
    socket.close();
  };
}, []);
```

### 5. ãƒ•ã‚©ãƒ¼ãƒ ã®è‡ªå‹•ä¿å­˜

```tsx
useEffect(() => {
  // å…¥åŠ›ãŒå¤‰ã‚ã£ã¦ã‹ã‚‰500ãƒŸãƒªç§’å¾Œã«è‡ªå‹•ä¿å­˜
  const timer = setTimeout(() => {
    saveFormData(formValues);
  }, 500);
  
  return () => {
    clearTimeout(timer);
  };
}, [formValues, saveFormData]);
```

## 9.7 useEffectã®ä½¿ç”¨ã«é–¢ã™ã‚‹æ³¨æ„ç‚¹

### 1. ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’é¿ã‘ã‚‹

useEffect ã®ä¾å­˜é…åˆ—ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„ã¨ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```tsx
// ğŸ”´ ç„¡é™ãƒ«ãƒ¼ãƒ—ã®ä¾‹
const [count, setCount] = useState(0);

useEffect(() => {
  // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå†…ã§ã‚¹ãƒ†ãƒ¼ãƒˆã‚’æ›´æ–°
  setCount(count + 1);
  // count ãŒä¾å­˜é…åˆ—ã«ã‚ã‚‹ãŸã‚ã€ã‚¹ãƒ†ãƒ¼ãƒˆãŒæ›´æ–°ã•ã‚Œã‚‹ãŸã³ã«
  // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå†å®Ÿè¡Œã•ã‚Œã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã«ãªã‚‹
}, [count]);
```

### 2. ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã®å¯¾å‡¦

éåŒæœŸå‡¦ç†ã‚’å«ã‚€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã§ã¯ã€ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ï¼ˆç«¶åˆçŠ¶æ…‹ï¼‰ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

```tsx
useEffect(() => {
  let isMounted = true; // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ã‚’è¿½è·¡
  
  const fetchData = async () => {
    const response = await fetch(url);
    const data = await response.json();
    
    // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã¾ã ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿ã‚¹ãƒ†ãƒ¼ãƒˆã‚’æ›´æ–°
    if (isMounted) {
      setData(data);
    }
  };
  
  fetchData();
  
  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°
  return () => {
    isMounted = false; // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã“ã¨ã‚’ãƒãƒ¼ã‚¯
  };
}, [url]);
```

### 3. éå‰°ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é¿ã‘ã‚‹

ä¾å­˜é…åˆ—ã«ä¸è¦ãªå€¤ã‚’å«ã‚ã‚‹ã¨ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒéå‰°ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

### 4. ESLintã®ãƒ«ãƒ¼ãƒ«ã‚’æ´»ç”¨ã™ã‚‹

React ã® ESLint ãƒ«ãƒ¼ãƒ«ï¼ˆeslint-plugin-react-hooksï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€useEffect ã®ä¾å­˜é…åˆ—ã«é–¢ã™ã‚‹å•é¡Œã‚’æ¤œå‡ºã§ãã¾ã™ã€‚

## 9.8 useEffect vs. useLayoutEffect

React ã«ã¯ `useEffect` ã®ä»–ã« `useLayoutEffect` ã¨ã„ã†ãƒ•ãƒƒã‚¯ã‚‚ã‚ã‚Šã¾ã™ã€‚åŸºæœ¬çš„ãªæ§‹æ–‡ã¯åŒã˜ã§ã™ãŒã€å®Ÿè¡Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒç•°ãªã‚Šã¾ã™ã€‚

- **useEffect**: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã«éåŒæœŸã§å®Ÿè¡Œï¼ˆã»ã¨ã‚“ã©ã®ã‚±ãƒ¼ã‚¹ã§ä½¿ç”¨ï¼‰
- **useLayoutEffect**: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒç”»é¢ã‚’æ›´æ–°ã™ã‚‹å‰ã«åŒæœŸçš„ã«å®Ÿè¡Œï¼ˆDOMæ¸¬å®šã‚„æ¡ä»¶ã«ã‚ˆã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ãªã©ï¼‰

```tsx
// ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ¸¬å®šã¨èª¿æ•´
useLayoutEffect(() => {
  // DOMè¦ç´ ã®æ¸¬å®š
  const { height } = ref.current.getBoundingClientRect();
  
  // æ¸¬å®šçµæœã«åŸºã¥ã„ã¦ã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª¿æ•´
  if (height > maxHeight) {
    setStyle({ overflow: 'auto', height: `${maxHeight}px` });
  }
}, [maxHeight]);
```

ä¸€èˆ¬çš„ã«ã€`useEffect` ã§ååˆ†ãªå ´åˆãŒã»ã¨ã‚“ã©ã§ã‚ã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡ŒãŒãªã„é™ã‚Š `useLayoutEffect` ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚
